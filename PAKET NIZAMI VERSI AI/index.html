<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nizami Super App</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="stylesheet" href="styles.css">

    <style>
        /* === GLOBAL STYLE (DARK PREMIUM) === */
        body { background-color: #050505; color: #fff; font-family: 'Poppins', sans-serif; margin: 0; padding-bottom: 90px; overflow-x: hidden; }
        
        /* HEADER */
        header { padding: 15px 20px; background: linear-gradient(180deg, #0a2015 0%, #050505 100%); text-align: center; position: sticky; top: 0; z-index: 50; border-bottom: 1px solid #1a1a1a; }
        .app-title { font-family: 'Pacifico', cursive; color: #ffd700; margin: 0; font-size: 1.5rem; }
        .app-subtitle { font-size: 0.75rem; color: #4ade80; letter-spacing: 1px; }

        /* NAVIGATION */
        .bottom-nav { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(10px); border: 1px solid #333; border-radius: 50px; display: flex; justify-content: space-around; padding: 10px 0; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .nav-item { display: flex; flex-direction: column; align-items: center; color: #888; font-size: 0.7rem; cursor: pointer; transition: 0.3s; }
        .nav-item i { font-size: 1.4rem; margin-bottom: 4px; }
        .nav-item.active { color: #ffd700; } .nav-item.active i { transform: translateY(-3px); text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

        /* TABS */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.4s; }
        .tab-content.active { display: block; }

      /* === UPDATE STYLE KATALOG === */

/* Grid Utama (Untuk Paket) */
.menu-grid { 
    display: grid; 
    grid-template-columns: repeat(3, 1fr); 
    gap: 10px; /* Jarak antar kotak */
    margin-bottom: 20px;
}

/* Grid Kecil (Untuk Galeri & Owner) */
.menu-grid-small {
    display: grid; 
    grid-template-columns: 1fr 1fr; /* Bagi 2 kolom */
    gap: 10px;
}

/* Card Style Standar (Kotak) */
.menu-card { 
    background: #151515; border: 1px solid #333; border-radius: 12px; 
    aspect-ratio: 1/1; /* Tetap kotak untuk paket */
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    text-decoration: none; color: #fff; transition: 0.2s;
    padding: 5px;
}

/* Card Style Compact (Untuk Galeri & Owner) */
.menu-card-compact {
    background: #151515; border: 1px solid #333; border-radius: 12px;
    padding: 15px; /* Padding lebih kecil */
    display: flex; flex-direction: row; /* Ikon di samping teks */
    align-items: center; justify-content: center; gap: 10px;
    text-decoration: none; color: #fff; transition: 0.2s;
}
.menu-card-compact i { font-size: 1.2rem; margin: 0; }
.menu-card-compact h3 { font-size: 0.85rem; margin: 0; font-weight: 500; }

/* Video Thumbnail Card */
/* === VIDEO LIST COMPACT (BARU) === */
.video-compact-item {
    display: flex; /* Menyusun ke samping */
    align-items: center;
    background: #151515;
    border: 1px solid #333;
    border-radius: 12px;
    padding: 10px;
    margin-bottom: 10px; /* Jarak antar video lebih rapat */
    cursor: pointer;
    transition: background 0.2s;
    gap: 15px; /* Jarak antara gambar dan teks */
}

.video-compact-item:active {
    background: #252525;
    transform: scale(0.98);
}

/* Kotak Pembungkus Gambar Kecil */
.v-thumb-box {
    position: relative;
    width: 90px;  /* Lebar gambar tetap */
    height: 60px; /* Tinggi gambar tetap */
    flex-shrink: 0; /* Agar gambar tidak gepeng */
    border-radius: 8px;
    overflow: hidden;
}

.v-thumb-img {
    width: 100%; height: 100%; object-fit: cover;
}

/* Icon Play Kecil di tengah gambar */
.v-play-mini {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 24px; height: 24px;
    background: rgba(0,0,0,0.7); border-radius: 50%; 
    border: 1px solid #ffd700; color: #ffd700; 
    font-size: 0.6rem; display: flex; align-items: center; justify-content: center;
}

/* Bagian Judul di Kanan */
.v-info {
    flex: 1; /* Mengisi sisa ruang kosong */
}

.v-info h4 {
    margin: 0; 
    font-size: 0.85rem; 
    color: #fff; 
    font-weight: 500; 
    line-height: 1.3;
}

.v-info span {
    font-size: 0.7rem; 
    color: #888; 
    margin-top: 4px; 
    display: block;
}
.v-info span i { color: #4ade80; margin-right:4px; }
.video-thumb-img { width: 100%; height: auto; display: block; opacity: 0.8; transition: 0.3s; }
.video-item:hover .video-thumb-img { opacity: 1; transform: scale(1.02); }
.play-icon-overlay {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 50px; height: 50px; background: rgba(0,0,0,0.7);
    border-radius: 50%; display: flex; align-items: center; justify-content: center;
    border: 2px solid #ffd700; color: #ffd700; font-size: 1.2rem;
}
.video-title-overlay {
    position: absolute; bottom: 0; left: 0; width: 100%;
    background: linear-gradient(to top, #000, transparent);
    padding: 20px 10px 10px 10px; box-sizing: border-box;
    font-size: 0.85rem; color: #fff; font-weight: bold;
}

/* VIDEO FULLSCREEN MODAL */
.video-modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 10000; display: none;
    flex-direction: column; justify-content: center;
}
.video-modal-overlay.show { display: flex; animation: fadeIn 0.3s; }
.video-frame-container { width: 100%; height: 100%; max-height: 80vh; background: #000; }
.video-frame-container iframe { width: 100%; height: 100%; border: none; }
.btn-close-video {
    position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
    background: #c4302b; color: #fff; border: none;
    padding: 10px 25px; border-radius: 50px; font-weight: bold;
    display: flex; align-items: center; gap: 8px; cursor: pointer;
    box-shadow: 0 0 20px rgba(0,0,0,0.8);
}
        .menu-card:active { transform: scale(0.95); background: #222; }
        .menu-card i { font-size: 1.8rem; margin-bottom: 8px; }
        .menu-card h3 { font-size: 0.75rem; margin: 0; font-weight: 500; }

        /* === DASHBOARD SETORAN (REVISI RAPI) === */
.dashboard-card { 
    background: #151515; 
    border: 1px solid #333; 
    border-radius: 16px; 
    padding: 20px; 
    margin-bottom: 20px; 
    display: flex; 
    flex-direction: column;
    text-align: left; /* Rata Kiri */
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}

/* Header: Nama & Info */
.dash-header {
    border-bottom: 1px dashed #333;
    padding-bottom: 15px;
    margin-bottom: 15px;
}
.dash-name { 
    font-size: 1.5rem; 
    font-weight: 700; 
    margin: 0 0 8px 0; 
    color: #fff; 
    line-height: 1.2;
}
.dash-meta {
    display: flex;
    align-items: center;
    gap: 8px;
}
.dash-id { 
    background: #222; color: #888; 
    padding: 4px 8px; border-radius: 6px; 
    font-size: 0.75rem; font-family: monospace; border: 1px solid #333;
}
.dash-badge { 
    position: static; /* Tidak melayang lagi */
    background: rgba(0, 123, 255, 0.15); 
    color: #4ade80; border: 1px solid rgba(74, 222, 128, 0.3);
    padding: 4px 8px; border-radius: 6px; 
    font-size: 0.75rem; font-weight: bold; text-transform: uppercase; 
}

/* Area Progress Bar */
.prog-area {
    background: #0a0a0a;
    border: 1px solid #252525;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 15px;
}
.prog-info-top { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 0.85rem; color: #ccc; }
.prog-track { background: #333; height: 10px; border-radius: 5px; overflow: hidden; width: 100%; }
.prog-fill { height: 100%; background: linear-gradient(90deg, #ffd700, #ffb700); width: 0%; transition: width 1s ease; border-radius: 5px; }
.prog-info-bottom { display: flex; justify-content: space-between; margin-top: 10px; font-size: 0.8rem; }

/* Tombol Full Width */
.btn-action-group { display: flex; flex-direction: column; gap: 10px; width: 100%; }
.btn-primary, .btn-danger { width: 100%; justify-content: center; } /* Pastikan tombol rata tengah isinya */

        /* Tombol Aksi */
        .btn-action-group { display: grid; gap: 10px; }
        .btn-primary { 
            width: 100%; padding: 12px; background: #073116; color: #4ade80; 
            border: 1px solid #28a745; border-radius: 10px; font-weight: bold; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-danger { 
            width: 100%; padding: 12px; background: rgba(255,0,0,0.1); color: #ff4d4d; 
            border: 1px solid #ff4d4d; border-radius: 10px; font-weight: bold; cursor: pointer; 
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }

        /* MITRA DASHBOARD */
        .mitra-list-item { background: #151515; border: 1px solid #333; border-radius: 12px; padding: 15px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 10px; }
        .m-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .m-percent-badge { background: #222; border: 1px solid #444; color: #ffd700; padding: 6px 10px; border-radius: 8px; font-size: 0.85rem; font-weight: bold; }
        .btn-mitra-cal { background: #073116; border: 1px solid #28a745; color: #fff; padding: 10px; border-radius: 8px; font-size: 0.8rem; width: 100%; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }

        /* FORM LOGIN & DAFTAR */
        .form-login { background: #111; padding: 20px; border-radius: 15px; border: 1px solid #333; }
        .input-dark { width: 100%; padding: 12px; background: #000; border: 1px solid #444; color: #fff; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box; }
        .btn-gold { width: 100%; padding: 12px; background: #ffd700; color: #000; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        .form-content-locked { opacity: 0.3; pointer-events: none; transition: 0.3s; }
        .form-content-active { opacity: 1; pointer-events: auto; }
        .akad-check-container { background: rgba(40, 167, 69, 0.1); border: 1px solid #28a745; padding: 15px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; }

        /* MULTI SELECT PAKET LIST */
        .paket-list-container {
            max-height: 250px; overflow-y: auto; border: 1px solid #333; 
            border-radius: 8px; padding: 10px; background: #000; margin-bottom: 15px;
        }
        .paket-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 0; border-bottom: 1px dashed #333;
        }
        .paket-item:last-child { border-bottom: none; }
        .paket-label { font-size: 0.85rem; flex: 1; color: #ddd; }
        .qty-controls { display: flex; align-items: center; gap: 8px; }
        .btn-qty-mini { width: 24px; height: 24px; background: #333; border: 1px solid #555; color: #fff; border-radius: 4px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .qty-val-mini { width: 20px; text-align: center; font-size: 0.9rem; font-weight: bold; color: #fff; }
        .qty-active .qty-val-mini { color: #ffd700; }

        /* DYNAMIC PRODUCT LIST */
        .category-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 10px; margin-bottom: 15px; }
        .cat-btn { background: #333; color: #ccc; border: 1px solid #444; padding: 6px 12px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; white-space: nowrap; }
        .cat-btn.active { background: #ffd700; color: #000; font-weight: bold; border-color: #ffd700; }
        .prod-card { background: #222; border: 1px solid #333; padding: 10px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .prod-info h4 { margin: 0; font-size: 0.9rem; color: #fff; }
        .prod-info p { margin: 0; font-size: 0.8rem; color: #4ade80; }
        
        /* CHECKOUT MODAL STYLES */
        .checkout-option { display: flex; gap: 10px; margin-bottom: 15px; }
        .chk-btn { flex: 1; padding: 15px; background: #222; border: 1px solid #444; border-radius: 10px; cursor: pointer; text-align: center; transition: 0.2s; }
        .chk-btn.active { background: #ffd700; color: #000; border-color: #ffd700; font-weight: bold; }
        .calc-table { width: 100%; font-size: 0.85rem; border-collapse: collapse; margin-bottom: 20px; }
        .calc-table td { padding: 8px 0; border-bottom: 1px dashed #333; }
        .calc-total { font-size: 1.2rem; color: #4ade80; font-weight: bold; text-align: right; }
        .calc-danger { color: #ff4d4d; }

        /* MODAL */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: none; justify-content: center; align-items: center; overflow-y: auto; padding: 20px 0; }
        .modal-overlay.show { display: flex; animation: fadeIn 0.3s; }
        .modal-card { background: #1a1a1a; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; border: 1px solid #333; position: relative; max-height: 90vh; overflow-y: auto; }
        .close-x { position: absolute; top: 15px; right: 15px; background: none; border: none; color: #aaa; font-size: 1.5rem; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* === TAMBAHAN STYLE BARU === */

/* Tombol Mode Kemasan (Cookies) */
.mode-selector { display: flex; gap: 10px; margin-bottom: 15px; background: #222; padding: 5px; border-radius: 10px; }
.btn-mode { flex: 1; padding: 10px; border: 1px solid #444; background: #111; color: #888; border-radius: 8px; cursor: pointer; font-size: 0.85rem; transition: 0.3s; }
.btn-mode.active { background: #ffd700; color: #000; font-weight: bold; border-color: #ffd700; }

/* Kotak Rincian (Summary) */
.summary-box { 
    background: #1a1a1a; border: 1px solid #333; border-radius: 12px; 
    padding: 15px; margin-top: 20px; 
}
.summary-title { color: #ffd700; font-size: 0.9rem; margin-bottom: 10px; border-bottom: 1px dashed #444; padding-bottom: 5px; }
.summary-item { display: flex; justify-content: space-between; font-size: 0.8rem; color: #ccc; margin-bottom: 6px; }
.summary-total { display: flex; justify-content: space-between; font-size: 1rem; color: #4ade80; font-weight: bold; margin-top: 10px; border-top: 1px solid #444; padding-top: 10px; }

/* === NEW KATALOG LAYOUT === */

/* Tombol Akad (Hero Section) */
.akad-hero {
    background: linear-gradient(135deg, #ffd700, #f39c12);
    color: #000;
    padding: 20px;
    border-radius: 16px;
    margin-bottom: 25px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-decoration: none;
    box-shadow: 0 5px 20px rgba(255, 215, 0, 0.3);
    border: 1px solid #ffe159;
    transition: transform 0.2s;
    position: relative;
    overflow: hidden;
}
.akad-hero:active { transform: scale(0.97); }
/* Efek kilau */
.akad-hero::after {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: linear-gradient(to right, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
    transform: rotate(30deg); animation: shine 3s infinite; pointer-events: none;
}
@keyframes shine { 0% {transform: translateX(-100%) rotate(30deg);} 100% {transform: translateX(100%) rotate(30deg);} }

.akad-hero i { font-size: 2rem; margin-right: 15px; }
.akad-text h3 { margin: 0; font-size: 1.1rem; font-weight: 800; letter-spacing: 0.5px; }
.akad-text p { margin: 0; font-size: 0.8rem; font-weight: 500; color: #333; }

/* Label Section */
.section-label {
    color: #fff; font-size: 0.95rem; font-weight: 600;
    margin: 25px 0 15px 0; border-left: 4px solid #ffd700;
    padding-left: 12px; letter-spacing: 0.5px;
}

/* Grid Khusus 2 Kolom (Untuk Galeri & Owner) */
.menu-grid-2 {
    display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
    max-width: 600px; margin: 0 auto;
}

/* Video Player Style (Embed) */
.video-list { display: flex; flex-direction: column; gap: 20px; }
.video-card-new { 
    background: #151515; border: 1px solid #333; border-radius: 16px; overflow: hidden; 
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
}
.video-header-new {
    padding: 12px 15px; background: linear-gradient(90deg, #111, #1a1a1a);
    color: #ffd700; font-size: 0.85rem; font-weight: bold;
    border-bottom: 1px solid #333; display: flex; align-items: center; gap: 10px;
}
.video-wrapper { 
    position: relative; padding-bottom: 56.25%; /* Rasio 16:9 */ height: 0; overflow: hidden; background: #000;
}
.video-wrapper iframe { 
    position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; 
}


/* === NEW PROFILE UI (PREMIUM) === */

/* Container Profil */
.profile-container {
    padding: 10px;
    animation: fadeIn 0.5s ease;
}

/* Kartu Utama (Header) */
.profile-header-card {
    background: linear-gradient(145deg, #1a1a1a, #0d0d0d);
    border: 1px solid #333;
    border-bottom: 3px solid #ffd700; /* Aksen Emas di bawah */
    border-radius: 20px;
    padding: 30px 20px;
    text-align: center;
    position: relative;
    margin-bottom: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    overflow: hidden;
}

/* Background Pattern (Hiasan) */
.profile-header-card::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, rgba(255,215,0,0.05) 0%, transparent 70%);
    pointer-events: none;
}

/* Avatar dengan Glow */
.profile-avatar-box {
    position: relative; margin: 0 auto 15px auto; width: 90px; height: 90px;
}
.profile-avatar-img {
    width: 100%; height: 100%; background: #222; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 2.5rem; color: #ffd700; border: 2px solid #ffd700;
    box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
    position: relative; z-index: 2;
}

/* Teks Nama & ID */
.profile-name { font-size: 1.4rem; font-weight: bold; color: #fff; margin: 0 0 5px 0; letter-spacing: 0.5px; position: relative; z-index: 2; }
.profile-badges { display: flex; justify-content: center; gap: 8px; position: relative; z-index: 2; }
.badge-role { background: #ffd700; color: #000; font-size: 0.7rem; padding: 4px 10px; border-radius: 15px; font-weight: bold; }
.badge-id { background: #333; color: #ccc; font-size: 0.7rem; padding: 4px 10px; border-radius: 15px; border: 1px solid #444; }

/* Info Paket Box */
.info-paket-box {
    background: #151515; border: 1px solid #333; border-radius: 15px;
    padding: 15px; display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 20px;
}
.ip-label { color: #888; font-size: 0.85rem; display: flex; align-items: center; gap: 8px; }
.ip-value { color: #4ade80; font-weight: bold; font-size: 1rem; text-align: right; }

/* Menu List Style */
.profile-menu-list { background: #151515; border-radius: 15px; border: 1px solid #333; overflow: hidden; margin-bottom: 25px; }
.menu-row {
    padding: 16px; border-bottom: 1px solid #222;
    display: flex; align-items: center; justify-content: space-between;
    color: #ddd; cursor: pointer; transition: 0.2s; font-size: 0.9rem;
}
.menu-row:last-child { border-bottom: none; }
.menu-row:active { background: #222; color: #ffd700; }
.menu-left { display: flex; align-items: center; gap: 12px; }
.menu-row i { color: #888; width: 20px; text-align: center; }

/* Logout Button */
.btn-logout-fancy {
    width: 100%; padding: 15px;
    background: transparent; color: #ff4d4d;
    border: 1px solid #ff4d4d; border-radius: 12px;
    font-weight: bold; font-size: 0.9rem; cursor: pointer;
    display: flex; align-items: center; justify-content: center; gap: 10px;
    transition: 0.2s;
}
.btn-logout-fancy:active { background: rgba(255, 77, 77, 0.1); transform: scale(0.98); }

.app-version { text-align: center; color: #444; font-size: 0.75rem; margin-top: 20px; margin-bottom: 80px; }
    </style>
</head>
<body>

    <header>
        <div class="app-title">Paket Nizami</div>
        <div class="app-subtitle">Paket Lebaran 2026-2027</div>
    </header>

   <div id="view-katalog" class="tab-content active">
        
        <a href="akad.html" class="akad-hero" style="margin-bottom:20px;">
            <div style="display:flex; align-items:center;">
                <i class="fas fa-file-signature"></i>
                <div class="akad-text">
                    <h3>AKAD & KETENTUAN</h3>
                    <p>Wajib dibaca sebelum daftar</p>
                </div>
            </div>
            <i class="fas fa-chevron-right"></i>
        </a>

        <div class="section-label">Pilihan Paket</div>
        <div class="menu-grid">
            <a href="mom.html" class="menu-card"><i class="fas fa-female" style="color:#ff6b6b;"></i><h3>MOM</h3></a>
            <a href="kids.html" class="menu-card"><i class="fas fa-child" style="color:#4ade80;"></i><h3>Kids</h3></a>
            <a href="mingguan.html" class="menu-card"><i class="fas fa-shopping-basket" style="color:#ffa502;"></i><h3>Mingguan</h3></a>
            <a href="cookies.html" class="menu-card"><i class="fas fa-cookie-bite" style="color:#a55eea;"></i><h3>Cookies</h3></a>
            <a href="uang.html" class="menu-card"><i class="fas fa-money-bill-wave" style="color:#48dbfb;"></i><h3>Uang</h3></a>
        </div>

        <div class="section-label">Informasi Lain</div>
        <div class="menu-grid-small">
            <a href="gallery.html" class="menu-card-compact">
                <i class="fas fa-images" style="color:#0fb9b1;"></i><h3>Galeri</h3>
            </a>
            <a href="owner.html" class="menu-card-compact">
                <i class="fas fa-user-tie" style="color:#fff;"></i><h3>Owner</h3>
            </a>
        </div>

        <div class="section-label" style="margin-top:25px; border-color:#ff4d4d;">Panduan Aplikasi</div>
        
        <div class="video-compact-item" onclick="playVideo('5-cKNVX73AY')">
            <div class="v-thumb-box">
                <img src="https://img.youtube.com/vi/5-cKNVX73AY/mqdefault.jpg" class="v-thumb-img">
                <div class="v-play-mini"><i class="fas fa-play"></i></div>
            </div>
            <div class="v-info">
                <h4>Cara Daftar & Login</h4>
                <span><i class="fas fa-clock"></i> Tonton Video</span>
            </div>
        </div>

        <div class="video-compact-item" onclick="playVideo('oO25rE0LDA8')">
            <div class="v-thumb-box">
                <img src="https://img.youtube.com/vi/oO25rE0LDA8/mqdefault.jpg" class="v-thumb-img">
                <div class="v-play-mini"><i class="fas fa-play"></i></div>
            </div>
            <div class="v-info">
                <h4>Penjelasan Menu & Fitur</h4>
                <span><i class="fas fa-clock"></i> Tonton Video</span>
            </div>
        </div>

        <div class="video-compact-item" onclick="playVideo('bgt42ADj8Bo')">
            <div class="v-thumb-box">
                <img src="https://img.youtube.com/vi/bgt42ADj8Bo/mqdefault.jpg" class="v-thumb-img">
                <div class="v-play-mini"><i class="fas fa-play"></i></div>
            </div>
            <div class="v-info">
                <h4>Info Penting Lainnya</h4>
                <span><i class="fas fa-clock"></i> Tonton Video</span>
            </div>
        </div>
        
        <br><br>
    </div>

    <div id="videoOverlay" class="video-modal-overlay">
        <div class="video-frame-container">
            <iframe id="youtubeFrame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
        </div>
        <button class="btn-close-video" onclick="closeVideo()">
            <i class="fas fa-arrow-left"></i> KEMBALI
        </button>
    </div>

    <div id="view-setoran" class="tab-content">
        <div id="state-guest" class="login-warning" style="text-align:center; padding:40px; border:1px dashed #444; border-radius:15px;">
            <i class="fas fa-lock" style="font-size:3rem; color:#444; margin-bottom:15px;"></i>
            <h3>Area Terbatas</h3>
            <p style="color:#888; font-size:0.9rem;">Silakan Login di menu <b>Akun Saya</b>.</p>
            <button onclick="switchTab('akun')" class="btn-gold" style="margin-top:10px; max-width:200px;">Ke Menu Login</button>
        </div>

        <div id="state-peserta" style="display:none;">
            <div id="peserta-container"></div>
        </div>

        <div id="state-mitra" style="display:none;">
            <h3 style="color:#ffd700;">Dashboard Mitra</h3>
            <input type="text" id="cariAnakBuah" placeholder="Cari nama peserta..." class="input-dark" onkeyup="filterMitra()">
            <div id="mitra-container" class="mitra-panel"></div>
        </div>
    </div>

    <div id="view-akun" class="tab-content">
        <div id="login-form" class="form-login">
            <h2 style="color:#ffd700; text-align:center;">Login Peserta</h2>
            <input type="text" id="login-id" class="input-dark" placeholder="ID Peserta / Mitra">
            <button onclick="prosesLogin()" class="btn-gold">MASUK</button>
            
            <div style="margin-top:25px; border-top:1px dashed #333; padding-top:15px; text-align:center;">
                <small style="color:#888;">Belum punya akun?</small>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
                    <div onclick="openModalDaftar()" style="background:#222; padding:15px; border-radius:10px; border:1px solid #444; cursor:pointer;">
                        <i class="fas fa-user-plus" style="color:#4ade80; font-size:1.5rem;"></i>
                        <div style="font-size:0.8rem; margin-top:5px;">Daftar Peserta</div>
                    </div>
                    <div onclick="openModalMitra()" style="background:#222; padding:15px; border-radius:10px; border:1px solid #444; cursor:pointer;">
                        <i class="fas fa-handshake" style="color:#4ade80; font-size:1.5rem;"></i>
                        <div style="font-size:0.8rem; margin-top:5px;">Daftar Mitra</div>
                    </div>
                </div>
                <a href="akad.html" style="display:block; margin-top:15px; color:#ffd700; font-size:0.85rem; text-decoration:none;"><i class="fas fa-file-contract"></i> Baca Akad & Perjanjian</a>
            </div>
        </div>
        <div id="user-profile" class="profile-container" style="display:none;">
            
            <div class="profile-header-card">
                <div class="profile-avatar-box">
                    <div class="profile-avatar-img"><i class="fas fa-user-astronaut"></i></div>
                </div>
                <h2 class="profile-name" id="prof-nama">Nama Pengguna</h2>
                <div class="profile-badges">
                    <span class="badge-role" id="prof-role">MEMBER</span>
                    <span class="badge-id" id="prof-id">ID: -</span>
                </div>
            </div>

            <div class="info-paket-box">
                <div class="ip-label"><i class="fas fa-box-open" style="color:#ffd700;"></i> Paket Aktif</div>
                <div class="ip-value" id="prof-paket">-</div>
            </div>

            <div class="profile-menu-list">
                <div class="menu-row" onclick="alert('Fitur Edit Profil akan segera hadir!')">
                    <div class="menu-left"><i class="fas fa-user-edit"></i> Edit Profil</div>
                    <i class="fas fa-chevron-right" style="font-size:0.8rem;"></i>
                </div>
                <div class="menu-row" onclick="window.open('https://wa.me/628122261036', '_blank')">
                    <div class="menu-left"><i class="fas fa-headset"></i> Bantuan Admin</div>
                    <i class="fas fa-chevron-right" style="font-size:0.8rem;"></i>
                </div>
                <div class="menu-row" onclick="alert('Versi Aplikasi: 2.0.1')">
                    <div class="menu-left"><i class="fas fa-info-circle"></i> Tentang Aplikasi</div>
                    <i class="fas fa-chevron-right" style="font-size:0.8rem;"></i>
                </div>
            </div>

            <button onclick="logout()" class="btn-logout-fancy">
                <i class="fas fa-power-off"></i> KELUAR / LOGOUT
            </button>

            <div class="app-version">Nizami App v2.0.1 &copy; 2026</div>
        </div>
    </div>

    <div id="modalDaftar" class="modal-overlay">
        <div class="modal-card">
            <button class="close-x" onclick="closeModalDaftar()">&times;</button>
            <h2 style="color:#ffd700; text-align:center; margin-bottom:20px;">Formulir Pendaftaran</h2>
            
            <div class="akad-check-container">
                <input type="checkbox" id="checkAkad" onchange="toggleFormPendaftaran(this)" style="transform: scale(1.5);">
                <label for="checkAkad" style="font-size:0.85rem; color:#fff; cursor:pointer;">
                    <b>Bismillah</b>, Saya sudah membaca dan menyetujui <a href="akad.html" target="_blank" style="color:#ffd700; text-decoration:underline;">Akad & Ketentuan</a>.
                </label>
            </div>

            <form id="formPendaftaran" class="form-content-locked" onsubmit="submitDaftarWA(event)">
                <input type="text" id="regNama" class="input-dark" placeholder="Nama Lengkap" required>
                <input type="tel" id="regHP" class="input-dark" placeholder="No. WhatsApp" required>
                <textarea id="regAlamat" class="input-dark" placeholder="Alamat Lengkap" rows="2" required></textarea>
                
                <label style="color:#aaa; font-size:0.85rem; display:block; margin-bottom:5px;">Pilih Paket (Bisa lebih dari satu):</label>
                
                <div id="paketListContainer" class="paket-list-container">
                    <div style="text-align:center; color:#666; padding:10px;">Memuat Paket...</div>
                </div>

                <div id="dynamicArea" style="margin-bottom:15px;"></div>

                <input type="text" id="regMitra" class="input-dark" placeholder="Nama Mitra (Jika ada)">
                
                <button type="submit" class="btn-gold">Kirim ke WA Admin</button>
            </form>
        </div>
    </div>

    <div id="modalCheckout" class="modal-overlay">
        <div class="modal-card">
            <button class="close-x" onclick="closeModalCheckout()">&times;</button>
            <h3 style="color:#ffd700; text-align:center; margin-bottom:20px;">Konfirmasi Berhenti</h3>
            
            <div class="checkout-option">
                <div class="chk-btn active" id="btnOptBarang" onclick="setCheckoutOption('barang')">
                    <i class="fas fa-box-open"></i><br>Ambil Barang
                </div>
                <div class="chk-btn" id="btnOptUang" onclick="setCheckoutOption('uang')">
                    <i class="fas fa-money-bill-wave"></i><br>Ambil Uang
                </div>
            </div>

            <div style="background:#222; padding:15px; border-radius:10px; margin-bottom:20px;">
                <table class="calc-table">
                    <tr><td>Saldo Saat Ini</td><td align="right" id="chk-saldo">Rp 0</td></tr>
                    <tr id="row-pinalti" style="color:#ff6b6b;"><td>Potongan / Pinalti</td><td align="right" id="chk-pinalti">- Rp 0</td></tr>
                    <tr style="border-top:1px solid #555; font-size:1rem;"><td><strong>Total Diterima</strong></td><td align="right" class="calc-total" id="chk-total">Rp 0</td></tr>
                </table>
                <div id="chk-note" style="font-size:0.75rem; color:#aaa; margin-top:10px; font-style:italic;">
                    *Sesuai Akad: Saldo barang dikembalikan utuh tanpa potongan.
                </div>
            </div>

            <button onclick="submitCheckoutWA()" class="btn-gold" style="background:#ff4d4d; color:#fff; border:none;">Ajukan Berhenti</button>
        </div>
    </div>

    <div id="modalMitraReg" class="modal-overlay">
        <div class="modal-card">
            <button class="close-x" onclick="closeModalMitra()">&times;</button>
            <h2 style="color:#ffd700; text-align:center; margin-bottom:15px;">Daftar Jadi Mitra</h2>

            <div class="akad-check-container" style="display:block; border-color:#007bff; background:rgba(0,123,255,0.1);">
                <h4 style="margin:0 0 10px 0; color:#4ade80; font-size:0.95rem;">Syarat & Ketentuan Mitra:</h4>
                <ul style="margin:0; padding-left:20px; color:#ddd; font-size:0.85rem; line-height:1.6;">
                    <li>Wajib <b>Jujur & Amanah</b>.</li>
                    <li>Menjaga <b>Shalat 5 Waktu</b>.</li>
                    <li>Siap mencapai <b>Target Minimal 10 Peserta</b>.</li>
                </ul>
                
                <div style="margin-top:15px; border-top:1px solid #444; padding-top:10px; display:flex; gap:10px; align-items:center;">
                    <input type="checkbox" id="checkSyaratMitra" onchange="toggleFormMitra(this)" style="transform: scale(1.3); cursor:pointer;">
                    <label for="checkSyaratMitra" style="font-size:0.85rem; cursor:pointer; color:#fff;">
                        Saya menyetujui persyaratan di atas.
                    </label>
                </div>
            </div>

            <form id="formMitra" class="form-content-locked" onsubmit="submitMitraWA(event)">
                <input type="text" id="mitraNama" class="input-dark" placeholder="Nama Lengkap" required>
                <input type="tel" id="mitraHP" class="input-dark" placeholder="No. WhatsApp" required>
                <textarea id="mitraAlamat" class="input-dark" placeholder="Alamat Lengkap" rows="2" required></textarea>
                
                <button type="submit" class="btn-gold">Ajukan via WA</button>
            </form>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('katalog')"><i class="fas fa-th-large"></i><span>Katalog</span></div>
        <div class="nav-item" onclick="switchTab('setoran')"><i class="fas fa-wallet"></i><span>Setoran</span></div>
        <div class="nav-item" onclick="switchTab('akun')"><i class="fas fa-user"></i><span>Akun Saya</span></div>
    </nav>

    <script src="script.js"></script>
    <script>
    // === GLOBAL DATA ===
    let DB_BARANG = [];
    let DB_PAKET = [];
    let selectedItems = {};     // Menyimpan barang yang dipilih (Qty & Harga)
    let selectedPakets = {};    // Menyimpan Paket Utama yang dipilih
    let cachedDashboardData = null; // Menyimpan data agar tidak loading terus
    let checkoutData = null; 
    let checkoutType = 'barang';
    
    // === VARIABLE KHUSUS COOKIES ===
    let cookieMode = null;      // 'plastik' atau 'toples'
    let cookieLimit = 0;        // 6 atau 5

    // === INITIAL LOAD ===
    window.onload = async () => {
        // Load Paket
        const paketData = await fetchData('getPaket');
        if(paketData) { DB_PAKET = paketData; renderPaketList(); }
        // Load Barang
        const barangData = await fetchData('getBarang');
        if(barangData) DB_BARANG = barangData;
        
        checkLoginStatus();
    };

    // === RENDER PAKET UTAMA (MULTI-SELECT) ===
    function renderPaketList() {
        const container = document.getElementById('paketListContainer');
        let html = '';
        DB_PAKET.forEach(p => {
            const safeName = p.nama.replace(/\s+/g, '_');
            html += `
                <div class="paket-item" id="row-${safeName}">
                    <div class="paket-label">${p.nama}</div>
                    <div class="qty-controls">
                        <div class="btn-qty-mini" onclick="updatePaketQty('${safeName}', '${p.nama}', -1)">-</div>
                        <div class="qty-val-mini" id="qty-pkt-${safeName}">0</div>
                        <div class="btn-qty-mini" onclick="updatePaketQty('${safeName}', '${p.nama}', 1)">+</div>
                    </div>
                </div>`;
        });
        container.innerHTML = html;
    }

    function updatePaketQty(id, name, change) {
        const el = document.getElementById(`qty-pkt-${id}`);
        const row = document.getElementById(`row-${id}`);
        let val = parseInt(el.innerText) + change;
        if(val < 0) val = 0;
        
        el.innerText = val;
        
        if(val > 0) { 
            selectedPakets[name] = val; 
            row.classList.add('qty-active'); 
        } else { 
            delete selectedPakets[name]; 
            row.classList.remove('qty-active'); 
        }
        
        // Reset pilihan barang setiap kali paket utama berubah agar tidak crash
        selectedItems = {}; 
        cookieMode = null;
        
        renderDynamicInputs();
    }

    // === LOGIKA TAMPILAN DINAMIS (COOKIES / MINGGUAN) ===
    function renderDynamicInputs() {
        const container = document.getElementById('dynamicArea');
        container.innerHTML = '';
        
        const keys = Object.keys(selectedPakets);
        let hasCookies = keys.some(k => k.toLowerCase().includes('cookies'));
        let hasMingguan = keys.some(k => k.toLowerCase().includes('mingguan'));

        // 1. Render UI Cookies (Jika paket cookies dipilih)
        if (hasCookies) {
            renderCookieUI(container);
        }
        
        // 2. Render UI Mingguan (Jika paket mingguan dipilih)
        if (hasMingguan) {
            renderMingguanUI(container);
        }
    }

    // === 1. FITUR COOKIES (PILIH KEMASAN & LIMIT) ===
    function renderCookieUI(container) {
        // Tampilkan Tombol Pilihan Kemasan
        const html = `
            <div style="margin-top:20px; border-top:1px dashed #333; padding-top:10px;">
                <label style="color:#ffd700; font-size:0.9rem; margin-bottom:10px; display:block;">Pilihan Cookies:</label>
                <div class="mode-selector">
                    <button type="button" class="btn-mode" id="btn-plastik" onclick="setCookieMode('plastik')">
                        <i class="fas fa-box"></i> Plastik (Max 6)
                    </button>
                    <button type="button" class="btn-mode" id="btn-toples" onclick="setCookieMode('toples')">
                        <i class="fas fa-archive"></i> Toples (Max 5)
                    </button>
                </div>
                <div id="cookieProdContainer">
                    <div style="text-align:center; color:#666; font-size:0.8rem; padding:15px; border:1px solid #333; border-radius:10px;">
                        <i class="fas fa-info-circle"></i> Silakan pilih jenis kemasan (Plastik/Toples) terlebih dahulu.
                    </div>
                </div>
                <div id="summaryCookie"></div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
    }

    function setCookieMode(mode) {
        // Reset barang jika ganti mode
        if(Object.keys(selectedItems).length > 0) {
            if(!confirm("Mengganti kemasan akan mereset pilihan kue Anda. Lanjutkan?")) return;
        }
        
        // Reset Data
        selectedItems = {};
        cookieMode = mode;
        cookieLimit = (mode === 'plastik') ? 6 : 5;

        // Update Tampilan Tombol
        document.querySelectorAll('.btn-mode').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${mode}`).classList.add('active');

        // Filter Barang: Hanya Kategori "Cookies"
        const items = DB_BARANG.filter(b => b.kategori === 'Cookies');
        
        // Render Barang (hidePrice = true)
        renderProductList(items, document.getElementById('cookieProdContainer'), false, true); 
        renderSummary(); // Refresh summary bawah
    }

    // === 2. FITUR MINGGUAN (HARGA /40 & TOTAL) ===
    function renderMingguanUI(container) {
        // Filter kategori selain Cookies
        const categories = [...new Set(DB_BARANG.map(item => item.kategori))].filter(k => k && k !== 'Cookies');
        
        let html = `
            <div style="margin-top:25px; border-top:1px dashed #333; padding-top:10px;">
                <label style="color:#ffd700; font-size:0.9rem;">Belanja Mingguan:</label>
                <div class="category-scroll" style="margin-top:10px;">
                    ${categories.map((cat, idx) => 
                        `<div class="cat-btn ${idx===0?'active':''}" onclick="switchCategory(this, '${cat}')">${cat}</div>`
                    ).join('')}
                </div>
                <div id="prodMingguanContainer"></div>
                <div id="summaryMingguan"></div>
            </div>
        `;
        
        container.insertAdjacentHTML('beforeend', html);
        
        // Render kategori pertama otomatis
        if(categories.length > 0) switchCategory(null, categories[0]);
    }

    function switchCategory(btn, cat) {
        if(btn) {
            document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        const items = DB_BARANG.filter(b => b.kategori === cat);
        // Render (isMingguan = true, hidePrice = false)
        renderProductList(items, document.getElementById('prodMingguanContainer'), true, false);
    }

    // === RENDER LIST BARANG (GENERIC) ===
    function renderProductList(items, container, isMingguan, hidePrice) {
        let html = '<div class="product-grid">'; // Grid 1 kolom (dari CSS Anda sebelumnya)
        items.forEach(item => {
            const itemId = item.nama.replace(/\s+/g, '_');
            
            // Hitung Harga Tampilan
            let displayPrice = Number(item.harga);
            let priceText = `Rp ${displayPrice.toLocaleString()}`;
            
            if(isMingguan) {
                displayPrice = Math.ceil(displayPrice / 40);
                priceText = `Rp ${displayPrice.toLocaleString()}/minggu`;
            }

            // Jika Mode Cookies, Kosongkan teks harga
            if(hidePrice) priceText = '';

            html += `
                <div class="prod-card">
                    <div class="prod-info">
                        <h4>${item.nama}</h4>
                        <p style="margin-top:2px;">${priceText}</p>
                    </div>
                    <div class="qty-controls">
                        <div class="btn-qty-mini" onclick="updateQty('${itemId}', '${item.nama}', ${item.harga}, -1, ${isMingguan})">-</div>
                        <div class="qty-val-mini" id="qty-${itemId}">${selectedItems[item.nama] ? selectedItems[item.nama].qty : 0}</div>
                        <div class="btn-qty-mini" onclick="updateQty('${itemId}', '${item.nama}', ${item.harga}, 1, ${isMingguan})">+</div>
                    </div>
                </div>
            `;
        });
        html += '</div>';
        container.innerHTML = html;
    }

    // === UPDATE QTY DENGAN LIMIT & SUMMARY ===
    function updateQty(id, name, price, change, isMingguan) {
        const el = document.getElementById(`qty-${id}`);
        let currentQty = parseInt(el.innerText);
        let newQty = currentQty + change;
        
        // 1. Validasi Tidak Boleh Minus
        if(newQty < 0) return;

        // 2. Validasi LIMIT KHUSUS COOKIES
        if(cookieMode && !isMingguan) {
            // Hitung total item cookies yang sudah dipilih
            let totalSelected = 0;
            // Filter hanya item yang ada di list cookies (sederhananya hitung semua di selectedItems karena reset saat ganti mode)
            Object.values(selectedItems).forEach(item => totalSelected += item.qty);
            
            // Jika mau nambah (+) tapi sudah limit
            if(change > 0 && (totalSelected + 1) > cookieLimit) {
                alert(`Maaf, Kemasan ${cookieMode} hanya muat ${cookieLimit} toples/pcs.`);
                return;
            }
        }

        // 3. Update UI Angka
        el.innerText = newQty;
        
        // 4. Update Data Penyimpanan
        if(newQty > 0) {
            selectedItems[name] = { qty: newQty, price: price, total: newQty * price };
        } else {
            delete selectedItems[name];
        }

        // 5. Update Summary di Bawah
        renderSummary(isMingguan);
    }

    // === RENDER SUMMARY (BARU) ===
    function renderSummary(isMingguan) {
        // Tentukan container mana yang dipakai (Cookies atau Mingguan)
        const containerId = isMingguan ? 'summaryMingguan' : 'summaryCookie';
        const container = document.getElementById(containerId);
        if(!container) return;

        if(Object.keys(selectedItems).length === 0) {
            container.innerHTML = '';
            return;
        }

        let totalUang = 0;
        let totalQtyCookies = 0;
        
        let html = `
        <div class="summary-box">
            <div class="summary-title">Rincian Pilihan:</div>`;
        
        Object.entries(selectedItems).forEach(([name, data]) => {
            let subtotal = 0;
            let labelKanan = '';

            if(isMingguan) {
                // Mingguan: Tampilkan Harga per Minggu
                let hargaMinggu = Math.ceil(data.price / 40);
                subtotal = hargaMinggu * data.qty;
                labelKanan = `Rp ${subtotal.toLocaleString()}`; // Subtotal mingguan
                totalUang += subtotal;
            } else {
                // Cookies: Hitung Qty saja
                totalQtyCookies += data.qty;
                labelKanan = ''; // Tidak tampil harga
            }

            html += `
            <div class="summary-item">
                <span>${data.qty}x ${name}</span>
                <span>${labelKanan}</span> 
            </div>`;
        });

        // Bagian Bawah Box Summary
        if(isMingguan) {
            // Tampilkan Total Iuran Mingguan
            html += `
            <div class="summary-total">
                <span>Total Setoran:</span>
                <span>Rp ${totalUang.toLocaleString()}/minggu</span>
            </div>`;
        } else {
            // Tampilkan Status Limit Cookies
            html += `
            <div class="summary-total" style="font-size:0.85rem; color:#ffd700;">
                <span>Terisi: ${totalQtyCookies} / ${cookieLimit} Item</span>
            </div>`;
        }

        html += `</div>`; // Tutup div summary-box
        container.innerHTML = html;
    }

    // === SUBMIT WA (UPDATE FORMAT) ===
    function submitDaftarWA(e) {
        e.preventDefault();
        const nama = document.getElementById('regNama').value;
        const hp = document.getElementById('regHP').value;
        const alamat = document.getElementById('regAlamat').value;
        const mitra = document.getElementById('regMitra').value || '-';
        
        if(Object.keys(selectedPakets).length === 0) return alert("Pilih minimal satu paket!");
        
        let msg = `Halo Admin, Bismillah saya daftar.\n\nüë§ Nama: ${nama}\nüì± WA: ${hp}\nüè† Alamat: ${alamat}\n\nüì¶ Paket Utama:\n`;
        Object.entries(selectedPakets).forEach(([pkt, qty]) => { msg += `- ${qty}x ${pkt}\n`; });
        
        if(Object.keys(selectedItems).length > 0) {
            msg += `\nüõí Rincian Barang:\n`;
            
            // Cek Mingguan atau Cookies untuk format pesan
            const isMingguan = Object.keys(selectedPakets).some(k => k.toLowerCase().includes('mingguan'));
            let totalMingguan = 0;

            Object.entries(selectedItems).forEach(([name, data]) => { 
                msg += `- ${data.qty}x ${name}\n`; 
                if(isMingguan) totalMingguan += (Math.ceil(data.price/40) * data.qty);
            });

            if(isMingguan) {
                msg += `\nüìÖ Total Setoran: Rp ${totalMingguan.toLocaleString()}/minggu`;
            } else if (cookieMode) {
                msg += `\nüì¶ Kemasan: ${cookieMode.toUpperCase()}`;
            }
        }
        
        msg += `\n\nü§ù Mitra: ${mitra}`;
        window.open(`https://wa.me/628122261036?text=${encodeURIComponent(msg)}`, '_blank');
        closeModalDaftar();
    }

    // === LOGIKA FORM MITRA ===
    function toggleFormMitra(checkbox) {
        const form = document.getElementById('formMitra');
        if(checkbox.checked) {
            form.classList.remove('form-content-locked');
            form.classList.add('form-content-active');
        } else {
            form.classList.add('form-content-locked');
            form.classList.remove('form-content-active');
        }
    }

    // Update fungsi submitMitraWA agar menyertakan konfirmasi syarat di pesan WA
    function submitMitraWA(e) {
        e.preventDefault();
        const nama = document.getElementById('mitraNama').value;
        const hp = document.getElementById('mitraHP').value;
        const alamat = document.getElementById('mitraAlamat').value;
        
        const msg = `Halo Admin, saya berminat daftar jadi MITRA.\n\nüë§ Nama: ${nama}\nüì± WA: ${hp}\nüè† Alamat: ${alamat}\n\n‚úÖ Saya menyatakan siap Jujur, Amanah, Shalat 5 waktu, dan mencapai target 10 peserta.`;
        
        window.open(`https://wa.me/628122261036?text=${encodeURIComponent(msg)}`, '_blank');
        closeModalMitra();
    }

    function submitMitraWA(e) {
        e.preventDefault();
        const nama = document.getElementById('mitraNama').value;
        const hp = document.getElementById('mitraHP').value;
        const alamat = document.getElementById('mitraAlamat').value;
        const msg = `Halo Admin, saya daftar MITRA.\n\nüë§ Nama: ${nama}\nüì± WA: ${hp}\nüè† Alamat: ${alamat}`;
        window.open(`https://wa.me/628122261036?text=${encodeURIComponent(msg)}`, '_blank');
        closeModalMitra();
    }

    // === LOGIN & DASHBOARD (SAMA SEPERTI SEBELUMNYA) ===
    function toggleFormPendaftaran(checkbox) {
        const form = document.getElementById('formPendaftaran');
        form.classList.toggle('form-content-locked', !checkbox.checked);
        form.classList.toggle('form-content-active', checkbox.checked);
    }

    function prosesLogin() {
        const id = document.getElementById('login-id').value.trim().toUpperCase();
        if(!id) return alert('Masukkan ID!');
        const btn = document.querySelector('#login-form button'); btn.innerText = '...'; btn.disabled = true;
        fetchData('cekStatusDetail', {id: id}).then(data => {
            btn.innerText = 'MASUK'; btn.disabled = false;
            if(!data || data.error) alert('ID Tidak Ditemukan!'); else {
                const userData = { id: id, type: data.type, nama: data.nama, paket: data.type === 'PESERTA' ? data.data[0].jenisPaket : 'MITRA' };
                localStorage.setItem('nizami_user', JSON.stringify(userData)); alert('Login Berhasil!'); renderProfile(); switchTab('setoran');
            }
        });
    }

    function checkLoginStatus() {
        const userStr = localStorage.getItem('nizami_user');
        if(!userStr) { document.getElementById('state-guest').style.display='block'; document.getElementById('state-peserta').style.display='none'; document.getElementById('state-mitra').style.display='none'; } 
        else { 
            const user = JSON.parse(userStr); document.getElementById('state-guest').style.display='none';
            if(user.type === 'MITRA') { document.getElementById('state-mitra').style.display='block'; loadMitraDashboard(user.id); } 
            else { document.getElementById('state-peserta').style.display='block'; loadPesertaDashboard(user.id); }
        }
    }

    async function loadPesertaDashboard(id) {
        const container = document.getElementById('peserta-container');
        
        // 1. CEK CACHE DULU
        // Jika data sudah ada di memori, pakai itu langsung (Tanpa Loading)
        if (cachedDashboardData) {
            renderPesertaCards(cachedDashboardData, container);
            return; 
        }

        // 2. JIKA CACHE KOSONG, BARU FETCH
        container.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">Sedang memuat data...</div>';
        const data = await fetchData('cekStatusDetail', {id: id});
        
        if(data && data.data && data.data.length > 0) {
            cachedDashboardData = data.data; // SIMPAN KE CACHE
            renderPesertaCards(cachedDashboardData, container);
        } else { 
            container.innerHTML = '<p style="text-align:center; color:#ff6b6b;">Data tidak ditemukan.</p>'; 
        }
    }

    // Fungsi Render dipisah agar rapi (Peserta)
    function renderPesertaCards(dataList, container) {
        let html = '';
        dataList.forEach(p => {
            const done = p.setoranDilakukan || 0;
            const target = p.totalSetoran || 330;
            const sisa = p.sisaSetoran;
            const percent = Math.min(100, (done/target)*100).toFixed(0);
            const statusText = sisa <= 0 ? "LUNAS" : `${sisa}x lagi`;

            html += `
                <div class="dashboard-card">
                    <div class="dash-header">
                        <h2 class="dash-name">${p.nama}</h2>
                        <div class="dash-meta">
                            <span class="dash-id">ID: ${p.idPeserta}</span>
                            <span class="dash-badge">${p.jenisPaket}</span>
                        </div>
                    </div>
                    <div class="prog-area">
                        <div class="prog-info-top">
                            <span>Progres</span>
                            <span style="color:#ffd700; font-weight:bold;">${percent}%</span>
                        </div>
                        <div class="prog-track">
                            <div class="prog-fill" style="width:${percent}%"></div>
                        </div>
                        <div class="prog-info-bottom">
                            <span style="color:#4ade80;">‚úî Terkumpul: ${done}x</span>
                            <span style="color:#ff6b6b;">‚è≥ Kurang: ${statusText}</span>
                        </div>
                    </div>
                    <div class="btn-action-group">
                        <button class="btn-primary" onclick="bukaKalenderIndividu('${p.idPeserta}', '${encodeURIComponent(p.nama)}', '${encodeURIComponent(p.jenisPaket)}', ${done})">
                            <i class="far fa-calendar-alt"></i> Cek Kalender
                        </button>
                        <button class="btn-danger" onclick="openCheckout('${p.idPeserta}', '${encodeURIComponent(p.nama)}', '${encodeURIComponent(p.jenisPaket)}', ${p.nilaiSetoran})">
                            <i class="fas fa-sign-out-alt"></i> Berhenti / Checkout
                        </button>
                    </div>
                </div>`;
        });
        container.innerHTML = html;
    }

   async function loadMitraDashboard(id) {
        const container = document.getElementById('mitra-container');

        // 1. CEK CACHE
        if (cachedDashboardData) {
            renderMitraCards(cachedDashboardData, container);
            return;
        }
        
        // 2. FETCH JIKA BELUM ADA
        container.innerHTML = '<div style="text-align:center; padding:20px; color:#888;">Sedang memuat data peserta...</div>';
        const data = await fetchData('cekStatusDetail', {id: id});
        
        if(data && data.data && data.data.length > 0) {
            cachedDashboardData = data.data; // SIMPAN KE CACHE
            renderMitraCards(cachedDashboardData, container);
        } else {
            container.innerHTML = '<p style="text-align:center; color:#888;">Belum ada peserta yang terdaftar.</p>';
        }
    }

    // Fungsi Render dipisah agar rapi (Mitra)
    function renderMitraCards(dataList, container) {
        let html = '';
        dataList.forEach(p => {
            const done = p.setoranDilakukan || 0;
            const target = p.totalSetoran || 330;
            const sisa = p.sisaSetoran;
            const percent = Math.min(100, (done/target)*100).toFixed(0);
            const statusText = sisa <= 0 ? "LUNAS" : `${sisa}x lagi`;

            html += `
                <div class="dashboard-card mitra-card">
                    <div class="dash-header">
                        <h2 class="dash-name">${p.nama}</h2>
                        <div class="dash-meta">
                            <span class="dash-id">ID: ${p.idPeserta}</span>
                            <span class="dash-badge">${p.jenisPaket}</span>
                        </div>
                    </div>
                    <div class="prog-area">
                        <div class="prog-info-top">
                            <span>Progres</span>
                            <span style="color:#ffd700; font-weight:bold;">${percent}%</span>
                        </div>
                        <div class="prog-track">
                            <div class="prog-fill" style="width:${percent}%"></div>
                        </div>
                        <div class="prog-info-bottom">
                            <span style="color:#4ade80;">‚úî Terkumpul: ${done}x</span>
                            <span style="color:#ff6b6b;">‚è≥ Kurang: ${statusText}</span>
                        </div>
                    </div>
                    <div class="btn-action-group">
                        <button class="btn-primary" onclick="bukaKalenderIndividu('${p.idPeserta}', '${encodeURIComponent(p.nama)}', '${encodeURIComponent(p.jenisPaket)}', ${done})">
                            <i class="far fa-calendar-alt"></i> Cek Kalender
                        </button>
                        <button class="btn-danger" onclick="openCheckout('${p.idPeserta}', '${encodeURIComponent(p.nama)}', '${encodeURIComponent(p.jenisPaket)}', ${p.nilaiSetoran})">
                            <i class="fas fa-sign-out-alt"></i> Berhenti / Checkout
                        </button>
                    </div>
                </div>`;
        });
        container.innerHTML = html;
    }

    // === CHECKOUT LOGIC ===
    function openCheckout(id, nama, paket, saldo) {
        checkoutData = { id: id, nama: decodeURIComponent(nama), paket: decodeURIComponent(paket), saldo: Number(saldo) };
        document.getElementById('modalCheckout').classList.add('show');
        setCheckoutOption('barang'); 
    }
    function closeModalCheckout() { document.getElementById('modalCheckout').classList.remove('show'); }
    
    function setCheckoutOption(type) {
        checkoutType = type;
        const btnBarang = document.getElementById('btnOptBarang');
        const btnUang = document.getElementById('btnOptUang');
        const note = document.getElementById('chk-note');
        const isMingguan = checkoutData.paket.toLowerCase().includes('mingguan');

        btnBarang.classList.remove('active'); btnUang.classList.remove('active');
        
        if(isMingguan) {
            btnUang.style.opacity = '0.3'; btnUang.onclick = () => alert('Paket Mingguan tidak bisa diuangkan kembali (Hanya Barang).');
            type = 'barang'; 
        }

        if(type === 'barang') {
            btnBarang.classList.add('active');
            calculateCheckoutValues(0);
            note.innerText = '*Sesuai Akad: Saldo barang dikembalikan utuh tanpa potongan.';
        } else {
            btnUang.classList.add('active');
            let pinalti = 0;
            const isUang = checkoutData.paket.toLowerCase().includes('uang');
            if(!isUang) {
                if(checkoutData.saldo < 200000) pinalti = 20000;
                else pinalti = Math.min(checkoutData.saldo * 0.1, 100000);
            }
            calculateCheckoutValues(pinalti);
            note.innerText = isUang ? '*Paket Uang bebas biaya pinalti.' : '*Paket Barang dikenakan biaya pinalti jika diambil tunai.';
        }
    }

    function calculateCheckoutValues(pinalti) {
        const saldo = checkoutData.saldo;
        const total = saldo - pinalti;
        document.getElementById('chk-saldo').innerText = 'Rp ' + saldo.toLocaleString();
        document.getElementById('chk-pinalti').innerText = '- Rp ' + pinalti.toLocaleString();
        document.getElementById('chk-total').innerText = 'Rp ' + total.toLocaleString();
    }

    function submitCheckoutWA() {
        const d = checkoutData;
        const pinalti = document.getElementById('chk-pinalti').innerText;
        const total = document.getElementById('chk-total').innerText;
        const metode = checkoutType === 'barang' ? 'AMBIL BARANG' : 'AMBIL UANG (REFUND)';
        
        const msg = `Halo Admin, saya ingin berhenti/checkout.\n\nüë§ Nama: ${d.nama}\nüÜî ID: ${d.id}\nüì¶ Paket: ${d.paket}\n\nüõë Metode: ${metode}\nüí∞ Saldo Awal: Rp ${d.saldo.toLocaleString()}\n‚úÇÔ∏è Potongan: ${pinalti}\nüíµ Total Diterima: ${total}`;
        window.open(`https://wa.me/628122261036?text=${encodeURIComponent(msg)}`, '_blank');
        closeModalCheckout();
    }
    // === NAVIGASI TABS (TAMBAHKAN INI) ===
    function switchTab(tabId) {
        // 1. Sembunyikan semua konten tab
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        
        // 2. Matikan status aktif di semua tombol navigasi
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        
        // 3. Tampilkan konten tab yang dipilih
        const targetTab = document.getElementById('view-' + tabId);
        if (targetTab) targetTab.classList.add('active');
        
        // 4. Nyalakan status aktif di tombol navigasi yang sesuai
        const tabs = ['katalog', 'setoran', 'akun'];
        const idx = tabs.indexOf(tabId);
        const navItems = document.querySelectorAll('.nav-item');
        if (navItems[idx]) navItems[idx].classList.add('active');
        
        // 5. Khusus Tab Setoran: Cek status login & load data
        if (tabId === 'setoran') {
            checkLoginStatus();
        }
        
        // 6. Khusus Tab Akun: Update tampilan profil
        if (tabId === 'akun') {
            renderProfile();
        }
    }

    // === UTILS ===
    function renderProfile() {
        const userStr = localStorage.getItem('nizami_user');
        if(userStr) {
            const user = JSON.parse(userStr); document.getElementById('login-form').style.display='none'; document.getElementById('user-profile').style.display='block';
            document.getElementById('prof-nama').innerText = user.nama; document.getElementById('prof-id').innerText = user.id; document.getElementById('prof-paket').innerText = user.paket;
        } else { document.getElementById('login-form').style.display='block'; document.getElementById('user-profile').style.display='none'; }
    }
  // Update fungsi Logout agar membersihkan cache
    function logout() { 
        if(confirm('Keluar?')) { 
            localStorage.removeItem('nizami_user'); 
            cachedDashboardData = null; // Hapus cache
            location.reload(); 
        } 
    }

    // Update fungsi Refresh agar memaksa ambil data baru
    function refreshData() { 
        cachedDashboardData = null; // Hapus cache agar maksa download baru
        const container = document.getElementById('peserta-container');
        const containerMitra = document.getElementById('mitra-container');
        
        // Beri feedback visual sedikit
        if(container) container.innerHTML = '<div style="text-align:center; padding:20px; color:#ffd700;">Mengambil data terbaru...</div>';
        if(containerMitra) containerMitra.innerHTML = '<div style="text-align:center; padding:20px; color:#ffd700;">Mengambil data terbaru...</div>';
        
        checkLoginStatus(); 
    }
    function openModalDaftar() { document.getElementById('modalDaftar').classList.add('show'); renderPaketList(); }
    function closeModalDaftar() { document.getElementById('modalDaftar').classList.remove('show'); }
    function openModalMitra() { document.getElementById('modalMitraReg').classList.add('show'); }
    function closeModalMitra() { document.getElementById('modalMitraReg').classList.remove('show'); }
    function openKalkulator() { document.getElementById('modalKalkulator').classList.add('show'); }
    function filterMitra() { 
        const input = document.getElementById('cariAnakBuah').value.toLowerCase();
        // Targetkan kartu yang baru dibuat (mitra-card)
        const cards = document.querySelectorAll('.mitra-card');
        
        cards.forEach(card => {
            // Cari nama di dalam elemen .dash-name
            const nama = card.querySelector('.dash-name').innerText.toLowerCase();
            // Show/Hide berdasarkan pencarian
            card.style.display = nama.includes(input) ? 'flex' : 'none';
        });
    }
    function bukaKalenderIndividu(id, nama, paket, jum) { window.location.href = `kalender.html?id=${id}&nama=${nama}&paket=${paket}&jumlah=${jum}`; }

    renderProfile();

// === VIDEO PLAYER LOGIC (TAMBAHKAN INI) ===
    function playVideo(videoId) {
        const modal = document.getElementById('videoOverlay');
        const iframe = document.getElementById('youtubeFrame');
        
        // Set URL Youtube dengan Autoplay
        if(modal && iframe) {
            iframe.src = `https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0`;
            modal.classList.add('show');
        }
    }

    function closeVideo() {
        const modal = document.getElementById('videoOverlay');
        const iframe = document.getElementById('youtubeFrame');
        
        // Hentikan video dengan menghapus src
        if(modal && iframe) {
            iframe.src = "";
            modal.classList.remove('show');
        }
    }

</script>
</body>
</html>